<!DOCTYPE html>
<html>
<head>
  <title>Image Debug Test</title>
  <style>
    img { border: 3px solid red; margin: 10px; display: block; }
    div { padding: 10px; margin: 10px; border: 1px solid #ccc; }
    .success { border-color: green; background: #e8f5e9; }
    .error { border-color: red; background: #ffebee; }
  </style>
</head>
<body>
  <h1>Content ID: 2100bdd1-9aef-48ea-bbb4-60f9ab875ac0</h1>

  <div id="test1">
    <h2>Test 1: 通过Vite代理</h2>
    <p>URL: /api/v1/content/2100bdd1-9aef-48ea-bbb4-60f9ab875ac0/local-media?type=cover</p>
    <img src="/api/v1/content/2100bdd1-9aef-48ea-bbb4-60f9ab875ac0/local-media?type=cover&_t=1"
         width="200"
         onload="this.parentElement.className='success'; this.nextElementSibling.textContent='✓ 图片加载成功 - Content-Type: ' + this.naturalWidth + 'x' + this.naturalHeight"
         onerror="this.parentElement.className='error'; this.nextElementSibling.textContent='✗ 图片加载失败'">
    <p>状态: 加载中...</p>
  </div>

  <div id="test2">
    <h2>Test 2: 直接访问后端</h2>
    <p>URL: http://localhost:3000/api/v1/content/2100bdd1-9aef-48ea-bbb4-60f9ab875ac0/local-media?type=cover</p>
    <img src="http://localhost:3000/api/v1/content/2100bdd1-9aef-48ea-bbb4-60f9ab875ac0/local-media?type=cover&_t=1"
         width="200"
         crossorigin="anonymous"
         onload="this.parentElement.className='success'; this.nextElementSibling.textContent='✓ 图片加载成功 - Content-Type: ' + this.naturalWidth + 'x' + this.naturalHeight"
         onerror="this.parentElement.className='error'; this.nextElementSibling.textContent='✗ 图片加载失败 (可能是CORS问题)'">
    <p>状态: 加载中...</p>
  </div>

  <div id="test3">
    <h2>Test 3: Fetch API 检查</h2>
    <p>状态: <span id="fetch-status">检查中...</span></p>
    <p>Content-Type: <span id="fetch-ctype">-</span></p>
    <p>Content-Length: <span id="fetch-len">-</span></p>
    <p>前20字节: <span id="fetch-bytes">-</span></p>
  </div>

  <script>
    // Test 3: Fetch API检查
    fetch('/api/v1/content/2100bdd1-9aef-48ea-bbb4-60f9ab875ac0/local-media?type=cover&_t=1')
      .then(response => {
        document.getElementById('fetch-status').textContent = response.ok ? '✓ 成功 (HTTP ' + response.status + ')' : '✗ 失败 (HTTP ' + response.status + ')';
        document.getElementById('fetch-ctype').textContent = response.headers.get('Content-Type');
        document.getElementById('fetch-len').textContent = response.headers.get('Content-Length');
        return response.blob();
      })
      .then(blob => {
        const reader = new FileReader();
        reader.onloadend = () => {
          const arr = new Uint8Array(reader.result);
          const bytes = Array.from(arr.slice(0, 20)).map(b => b.toString(16).padStart(2, '0')).join(' ');
          document.getElementById('fetch-bytes').textContent = bytes.toUpperCase();
          // 检查是否是JPEG
          if (arr[0] === 0xFF && arr[1] === 0xD8) {
            document.getElementById('fetch-bytes').textContent += ' (✓ JPEG格式)';
          } else if (arr[0] === 0x3C && arr[1] === 0x73) { // <s
            document.getElementById('fetch-bytes').textContent += ' (✗ SVG占位符!)';
          }
        };
        reader.readAsArrayBuffer(blob);
      })
      .catch(error => {
        document.getElementById('fetch-status').textContent = '✗ 网络错误: ' + error.message;
      });

    // 控制台日志
    console.log('测试页面已加载');
    console.log('时间戳:', Date.now());
  </script>
</body>
</html>
