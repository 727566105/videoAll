# Docker 部署检查清单

使用此检查清单确保 Docker 部署前所有必要的步骤都已完成。

## 📋 部署前检查

### 1. 环境准备

- [ ] Docker 版本 >= 20.10.0 已安装
- [ ] Docker Compose 版本 >= 2.0.0 已安装
- [ ] 系统有足够的磁盘空间（建议 >= 20GB）
- [ ] 系统有足够的内存（建议 >= 4GB）
- [ ] 端口 80、3000、5432、6379 未被占用

验证命令：
```bash
docker --version
docker-compose --version
df -h
free -h
lsof -i :80 -i :3000 -i :5432 -i :6379
```

### 2. 配置文件

- [ ] 已复制 `.env.docker` 为 `.env`
- [ ] 已修改 `POSTGRES_PASSWORD`（数据库密码）
- [ ] 已修改 `JWT_SECRET`（JWT 密钥）
- [ ] 已修改 `ENCRYPTION_KEY`（加密密钥，32 字节）
- [ ] 已修改 `VITE_CREDENTIAL_SECRET_KEY`（前端凭证密钥）
- [ ] 已根据需要修改端口配置

密码强度要求：
- 最少 16 个字符
- 包含大小写字母
- 包含数字
- 包含特殊字符

### 3. 目录结构

- [ ] `backups/` 目录已创建
- [ ] `logs/` 目录已创建
- [ ] `media/` 目录已创建（如果需要本地存储）

### 4. 网络配置

- [ ] 防火墙规则已配置（如需要）
- [ ] SSL 证书已准备（生产环境）
- [ ] 域名已配置（生产环境）
- [ ] DNS 解析已设置（生产环境）

### 5. 资源限制（可选但推荐）

- [ ] 已配置 CPU 限制
- [ ] 已配置内存限制
- [ ] 已配置磁盘空间限制
- [ ] 已配置日志轮转

## 🚀 部署步骤

### 1. 构建镜像

```bash
docker-compose build
```

检查：
- [ ] 所有镜像构建成功
- [ ] 无构建错误或警告

### 2. 启动服务

```bash
docker-compose up -d
```

检查：
- [ ] 所有容器成功启动
- [ ] 容器状态为 "healthy" 或 "running"

### 3. 验证服务

```bash
docker-compose ps
curl http://localhost:3000/api/v1/health
```

检查：
- [ ] PostgreSQL 服务健康
- [ ] Redis 服务健康
- [ ] 后端 API 可访问
- [ ] 前端页面可访问

### 4. 数据库初始化

```bash
docker-compose exec backend node src/scripts/initDatabase.js
```

检查：
- [ ] 数据库表已创建
- [ ] 默认管理员账号已创建
- [ ] 能够登录系统

### 5. 功能测试

- [ ] 用户登录功能正常
- [ ] 内容解析功能正常
- [ ] 文件上传功能正常
- [ ] 数据持久化正常
- [ ] OCR 识别功能正常

## 🔒 生产环境额外检查

### 安全配置

- [ ] 所有默认密码已修改
- [ ] JWT 密钥已更新
- [ ] 加密密钥已更新
- [ ] HTTPS 已启用
- [ ] SSL 证书有效
- [ ] 防火墙已配置
- [ ] 仅必要端口开放
- [ ] 跨域策略已配置

### 性能优化

- [ ] 已启用资源限制
- [ ] 已配置日志轮转
- [ ] 已启用缓存
- [ ] 已配置 CDN（如需要）
- [ ] 数据库已优化

### 监控和告警

- [ ] 日志监控已配置
- [ ] 性能监控已配置
- [ ] 错误告警已配置
- [ ] 磁盘空间监控已配置
- [ ] 服务健康检查已启用

### 备份和恢复

- [ ] 数据库自动备份已配置
- [ ] 媒体文件自动备份已配置
- [ ] 备份存储已配置（异地备份）
- [ ] 恢复流程已测试
- [ ] 灾难恢复计划已制定

## 📊 部署后验证

### 1. 服务健康检查

```bash
make health
# 或
curl http://localhost:3000/api/v1/health
```

- [ ] 所有服务状态正常
- [ ] 健康检查通过

### 2. 日志检查

```bash
docker-compose logs --tail=100
```

- [ ] 无错误日志
- [ ] 无异常警告

### 3. 资源使用检查

```bash
docker stats
```

- [ ] CPU 使用率正常
- [ ] 内存使用率正常
- [ ] 磁盘 I/O 正常

### 4. 功能验证

- [ ] 用户可以正常登录
- [ ] 内容可以正常解析
- [ ] 文件可以正常上传和下载
- [ ] 数据持久化正常
- [ ] 定时任务正常执行

### 5. 性能测试

- [ ] 页面加载时间 < 3 秒
- [ ] API 响应时间 < 1 秒
- [ ] 并发用户测试通过
- [ ] 文件上传测试通过

## 🔄 运维检查

### 日常维护

- [ ] 每日检查服务状态
- [ ] 每日检查错误日志
- [ ] 每日检查磁盘空间
- [ ] 每日检查备份完整性
- [ ] 每周检查性能指标
- [ ] 每月检查安全更新

### 定期任务

- [ ] 每周清理旧日志
- [ ] 每周清理旧备份
- [ ] 每月更新 Docker 镜像
- [ ] 每月检查依赖更新
- [ ] 每季度进行灾难恢复演练

### 应急准备

- [ ] 已创建应急联系人清单
- [ ] 已准备应急操作手册
- [ ] 已测试故障切换流程
- [ ] 已准备回滚方案

## 📝 文档和知识

- [ ] 部署文档已更新
- [ ] 配置变更已记录
- [ ] 操作手册已准备
- [ ] 故障排除文档已准备
- [ ] 团队培训已完成

## ✅ 部署完成确认

- [ ] 所有检查项已完成
- [ ] 所有测试已通过
- [ ] 相关人员已通知
- [ ] 监控已启用
- [ ] 备份已配置
- [ ] 文档已更新

---

**部署人**: _______________
**部署日期**: _______________
**审核人**: _______________
**审核日期**: _______________

## 📞 支持信息

- 技术支持: [support@example.com]
- 紧急联系: [phone]
- 文档: [link to documentation]
- Issue 追踪: [link to issue tracker]

---

**版本**: 1.0.0
**最后更新**: 2025-12-30
