# ç”¨æˆ·ç®¡ç† API æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

ç”¨æˆ·ç®¡ç†æ¨¡å—æä¾›ç”¨æˆ·è´¦æˆ·çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸ªäººä¿¡æ¯ç®¡ç†å’Œç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†ã€‚

**æ¥å£æ•°é‡**: 9ä¸ª
**åŸºç¡€è·¯å¾„**: `/api/v1/users`
**è®¤è¯è¦æ±‚**: æ‰€æœ‰æ¥å£å‡éœ€è¦è®¤è¯ âœ…

---

## ğŸ“‘ ä¸»è¦æ¥å£åˆ—è¡¨

### ä¸ªäººä¿¡æ¯ç®¡ç†ï¼ˆæ‰€æœ‰ç”¨æˆ·ï¼‰
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–å½“å‰ç”¨æˆ· | GET | `/me` | è·å–ä¸ªäººä¿¡æ¯ |
| æ›´æ–°å½“å‰ç”¨æˆ· | PUT | `/me` | æ›´æ–°ä¸ªäººä¿¡æ¯ |
| ä¿®æ”¹å½“å‰å¯†ç  | PUT | `/me/password` | ä¿®æ”¹è‡ªå·±çš„å¯†ç  |

### ç”¨æˆ·ç®¡ç†ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–æ‰€æœ‰ç”¨æˆ· | GET | `/` | è·å–ç”¨æˆ·åˆ—è¡¨ |
| åˆ›å»ºç”¨æˆ· | POST | `/` | åˆ›å»ºæ–°ç”¨æˆ· |
| è·å–ç”¨æˆ·è¯¦æƒ… | GET | `/:id` | æ ¹æ® ID è·å–ç”¨æˆ· |
| æ›´æ–°ç”¨æˆ· | PUT | `/:id` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| æ›´æ–°ç”¨æˆ·å¯†ç  | PUT | `/:id/password` | é‡ç½®ç”¨æˆ·å¯†ç  |
| åˆ é™¤ç”¨æˆ· | DELETE | `/:id` | åˆ é™¤ç”¨æˆ· |

---

## 8.1 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `GET /api/v1/users/me`
- **åŠŸèƒ½**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

---

### è¯·æ±‚å‚æ•°

æ— 

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "username": "admin",
    "role": "admin",
    "is_active": true,
    "created_at": "2025-12-28T10:00:00.000Z",
    "updated_at": "2025-12-28T10:00:00.000Z"
  }
}
```

---

### ä»£ç ç¤ºä¾‹

**JavaScript (Axios)**:
```javascript
const getCurrentUser = async () => {
  const response = await axios.get('/api/v1/users/me', {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
  return response.data;
};
```

---

## 8.2 æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `PUT /api/v1/users/me`
- **åŠŸèƒ½**: æ›´æ–°å½“å‰ç”¨æˆ·çš„éƒ¨åˆ†ä¸ªäººä¿¡æ¯
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

---

### è¯·æ±‚å‚æ•°

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| username | string | âŒ | æ–°ç”¨æˆ·åï¼ˆå¿…é¡»å”¯ä¸€ï¼‰ | `"newname"` |

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "ä¸ªäººä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": {
    "id": "uuid",
    "username": "newname",
    "role": "admin",
    "is_active": true,
    "updated_at": "2025-12-28T12:00:00.000Z"
  }
}
```

---

### é”™è¯¯å“åº”

**400 Bad Request**
```json
{
  "message": "ç”¨æˆ·åå·²å­˜åœ¨"
}
```

---

## 8.3 ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç 

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `PUT /api/v1/users/me/password`
- **åŠŸèƒ½**: ä¿®æ”¹å½“å‰ç”¨æˆ·è‡ªå·±çš„å¯†ç 
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: æ‰€æœ‰è®¤è¯ç”¨æˆ·

---

### è¯·æ±‚å‚æ•°

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| currentPassword | string | âœ… | å½“å‰å¯†ç  | `"oldpass123"` |
| newPassword | string | âœ… | æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ | `"newpass456"` |

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

---

### é”™è¯¯å“åº”

**400 Bad Request**
```json
{
  "message": "å½“å‰å¯†ç é”™è¯¯"
}
```

```json
{
  "message": "æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½"
}
```

---

### ä»£ç ç¤ºä¾‹

**JavaScript**:
```javascript
const changePassword = async (currentPassword, newPassword) => {
  await axios.put('/api/v1/users/me/password', {
    currentPassword,
    newPassword
  }, {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
};
```

---

## 8.4 è·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `GET /api/v1/users/`
- **åŠŸèƒ½**: è·å–ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„åˆ—è¡¨
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: ä»…ç®¡ç†å‘˜

---

### è¯·æ±‚å‚æ•°

æ— 

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "è·å–ç”¨æˆ·åˆ—è¡¨æˆåŠŸ",
  "data": [
    {
      "id": "uuid",
      "username": "admin",
      "role": "admin",
      "is_active": true,
      "created_at": "2025-12-28T10:00:00.000Z",
      "updated_at": "2025-12-28T10:00:00.000Z"
    },
    {
      "id": "uuid2",
      "username": "operator",
      "role": "operator",
      "is_active": true,
      "created_at": "2025-12-28T11:00:00.000Z",
      "updated_at": "2025-12-28T11:00:00.000Z"
    }
  ]
}
```

---

### é”™è¯¯å“åº”

**403 Forbidden**
```json
{
  "message": "æƒé™ä¸è¶³"
}
```

---

## 8.5 åˆ›å»ºç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `POST /api/v1/users/`
- **åŠŸèƒ½**: åˆ›å»ºæ–°ç”¨æˆ·è´¦æˆ·
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: ä»…ç®¡ç†å‘˜

---

### è¯·æ±‚å‚æ•°

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|--------|------|--------|
| username | string | âœ… | - | ç”¨æˆ·åï¼ˆå¿…é¡»å”¯ä¸€ï¼‰ | `"newuser"` |
| password | string | âœ… | - | å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ | `"password123"` |
| role | string | âŒ | operator | ç”¨æˆ·è§’è‰² | `"operator"` |

---

### æˆåŠŸå“åº” (201 Created)

```json
{
  "message": "ç”¨æˆ·åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "uuid",
    "username": "newuser",
    "role": "operator",
    "is_active": true,
    "created_at": "2025-12-28T12:00:00.000Z"
  }
}
```

---

### é”™è¯¯å“åº”

**400 Bad Request**
```json
{
  "message": "ç”¨æˆ·åå·²å­˜åœ¨"
}
```

```json
{
  "message": "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½"
}
```

---

### ä»£ç ç¤ºä¾‹

**cURL**:
```bash
curl -X POST "http://localhost:3000/api/v1/users/" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "newuser",
    "password": "password123",
    "role": "operator"
  }'
```

---

## 8.6 è·å–ç”¨æˆ·è¯¦æƒ…ï¼ˆç®¡ç†å‘˜ï¼‰

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `GET /api/v1/users/:id`
- **åŠŸèƒ½**: æ ¹æ® ID è·å–æŒ‡å®šç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: ä»…ç®¡ç†å‘˜

---

### è¯·æ±‚å‚æ•°

**Path å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | string | âœ… | ç”¨æˆ· IDï¼ˆUUIDï¼‰ | `"550e8400-..."` |

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ",
  "data": {
    "id": "uuid",
    "username": "admin",
    "role": "admin",
    "is_active": true,
    "created_at": "2025-12-28T10:00:00.000Z",
    "updated_at": "2025-12-28T10:00:00.000Z"
  }
}
```

---

## 8.7 æ›´æ–°ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `PUT /api/v1/users/:id`
- **åŠŸèƒ½**: æ›´æ–°æŒ‡å®šç”¨æˆ·çš„ä¿¡æ¯
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: ä»…ç®¡ç†å‘˜

---

### è¯·æ±‚å‚æ•°

**Path å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | string | âœ… | ç”¨æˆ· IDï¼ˆUUIDï¼‰ |

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| username | string | âŒ | æ–°ç”¨æˆ·å | `"newname"` |
| role | string | âŒ | ç”¨æˆ·è§’è‰² | `"operator"` |
| is_active | boolean | âŒ | æ˜¯å¦æ¿€æ´» | `false` |

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "ç”¨æˆ·æ›´æ–°æˆåŠŸ",
  "data": {
    "id": "uuid",
    "username": "newname",
    "role": "operator",
    "is_active": false,
    "updated_at": "2025-12-28T12:00:00.000Z"
  }
}
```

---

## 8.8 æ›´æ–°ç”¨æˆ·å¯†ç ï¼ˆç®¡ç†å‘˜ï¼‰

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `PUT /api/v1/users/:id/password`
- **åŠŸèƒ½**: ç®¡ç†å‘˜é‡ç½®æŒ‡å®šç”¨æˆ·çš„å¯†ç 
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: ä»…ç®¡ç†å‘˜

---

### è¯·æ±‚å‚æ•°

**Path å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | string | âœ… | ç”¨æˆ· IDï¼ˆUUIDï¼‰ |

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| newPassword | string | âœ… | æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ | `"newpass123"` |
| currentPassword | string | âŒ | å½“å‰å¯†ç ï¼ˆä»…ä¿®æ”¹è‡ªå·±æ—¶éœ€è¦ï¼‰ | `"oldpass123"` |

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "å¯†ç æ›´æ–°æˆåŠŸ"
}
```

---

### æ³¨æ„äº‹é¡¹

- âœ… ç®¡ç†å‘˜å¯ä»¥é‡ç½®ä»»ä½•ç”¨æˆ·çš„å¯†ç 
- âœ… ç”¨æˆ·ä¿®æ”¹è‡ªå·±çš„å¯†ç æ—¶éœ€è¦éªŒè¯å½“å‰å¯†ç 
- âš ï¸ å¯†ç é•¿åº¦è‡³å°‘6ä½

---

## 8.9 åˆ é™¤ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰

**åŸºæœ¬ä¿¡æ¯**
- **ç«¯ç‚¹**: `DELETE /api/v1/users/:id`
- **åŠŸèƒ½**: åˆ é™¤æŒ‡å®šç”¨æˆ·ï¼ˆè½¯åˆ é™¤ï¼‰
- **è®¤è¯**: âœ… éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: ä»…ç®¡ç†å‘˜

---

### è¯·æ±‚å‚æ•°

**Path å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| id | string | âœ… | ç”¨æˆ· IDï¼ˆUUIDï¼‰ |

---

### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "ç”¨æˆ·åˆ é™¤æˆåŠŸ"
}
```

---

### é”™è¯¯å“åº”

**400 Bad Request**
```json
{
  "message": "ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·"
}
```

```json
{
  "message": "ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªç”¨æˆ·è´¦æˆ·"
}
```

```json
{
  "message": "ä¸èƒ½åˆ é™¤è‡ªå·±çš„è´¦æˆ·"
}
```

---

### æ³¨æ„äº‹é¡¹

- âš ï¸ **è½¯åˆ é™¤**ï¼šç”¨æˆ·ä¸ä¼šè¢«çœŸæ­£åˆ é™¤ï¼Œè€Œæ˜¯æ ‡è®°ä¸ºå·²åˆ é™¤
- âš ï¸ **ä¿æŠ¤æœºåˆ¶**ï¼š
  - ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªç®¡ç†å‘˜
  - ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªç”¨æˆ·
  - ä¸èƒ½åˆ é™¤è‡ªå·±çš„è´¦æˆ·
- âœ… **deleted_at**: ç”¨æˆ·è¢«è½¯åˆ é™¤åï¼Œ`deleted_at` å­—æ®µä¼šè®¾ç½®æ—¶é—´æˆ³

---

## é™„å½•

### ç”¨æˆ·è§’è‰²

| è§’è‰² | è¯´æ˜ | æƒé™ |
|------|------|------|
| admin | ç®¡ç†å‘˜ | æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼ŒåŒ…æ‹¬ç”¨æˆ·ç®¡ç† |
| operator | æ“ä½œå‘˜ | æ™®é€šç”¨æˆ·æƒé™ï¼Œå¯è®¿é—®åŸºç¡€åŠŸèƒ½ |

### ç”¨æˆ·çŠ¶æ€

| çŠ¶æ€ | è¯´æ˜ |
|------|------|
| is_active: true | æ¿€æ´»çŠ¶æ€ï¼Œå¯ä»¥æ­£å¸¸ç™»å½• |
| is_active: false | ç¦ç”¨çŠ¶æ€ï¼Œæ— æ³•ç™»å½• |

### å¯†ç ç­–ç•¥

- æœ€å°é•¿åº¦ï¼š6ä½
- å»ºè®®ï¼šåŒ…å«å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
- å®šæœŸä¿®æ”¹å¯†ç ï¼ˆæ¨èï¼‰

---

## ç›¸å…³æ–‡æ¡£

- [è®¤è¯æ¨¡å—](./01_è®¤è¯æ¨¡å—.md)
- [è®¤è¯æœºåˆ¶è¯¦è§£](../02_è®¤è¯æœºåˆ¶è¯¦è§£.md)
- [User å®ä½“](../data_models/User_å®ä½“.md)

---

**æœ€åæ›´æ–°**: 2025-12-28
