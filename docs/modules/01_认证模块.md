# è®¤è¯æ¨¡å— API æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

è®¤è¯æ¨¡å—æä¾›ç”¨æˆ·ç™»å½•ã€é€€å‡ºã€ç³»ç»Ÿåˆå§‹åŒ–å’ŒçŠ¶æ€æ£€æŸ¥åŠŸèƒ½ã€‚

**æ¥å£æ•°é‡**: 4ä¸ª
**åŸºç¡€è·¯å¾„**: `/api/v1/auth`
**è®¤è¯è¦æ±‚**: æ‰€æœ‰æ¥å£å‡ä¸éœ€è¦è®¤è¯

---

## ğŸ“‘ ç›®å½•

- [1.1 ç”¨æˆ·ç™»å½•](#11-ç”¨æˆ·ç™»å½•)
- [1.2 ç”¨æˆ·é€€å‡º](#12-ç”¨æˆ·é€€å‡º)
- [1.3 æ£€æŸ¥ç³»ç»ŸçŠ¶æ€](#13-æ£€æŸ¥ç³»ç»ŸçŠ¶æ€)
- [1.4 ç³»ç»Ÿåˆå§‹åŒ–](#14-ç³»ç»Ÿåˆå§‹åŒ–)

---

## 1.1 ç”¨æˆ·ç™»å½•

**åŸºæœ¬ä¿¡æ¯**
- **æ¥å£åç§°**: ç”¨æˆ·ç™»å½•
- **ç«¯ç‚¹**: `POST /api/v1/auth/login`
- **åŠŸèƒ½æè¿°**: ç”¨æˆ·ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿï¼ŒæˆåŠŸåè¿”å› JWT Token
- **è®¤è¯è¦æ±‚**: âŒ ä¸éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: å…¬å¼€æ¥å£

---

### è¯·æ±‚å‚æ•°

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|--------|------|--------|
| username | string | âœ… | - | ç”¨æˆ·å | `"admin"` |
| password | string | âœ… | - | å¯†ç  | `"admin123"` |

---

### æˆåŠŸå“åº”

**HTTP çŠ¶æ€ç **: `200 OK`

```json
{
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin",
      "is_active": true,
      "created_at": "2025-12-28T10:00:00.000Z",
      "updated_at": "2025-12-28T10:00:00.000Z"
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCIsInVzZXJuYW1lIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3MzU0NDMwMDAsImV4cCI6MTczNjA0NzgwMH0.signature"
  }
}
```

**å“åº”å­—æ®µè¯´æ˜**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| message | string | å“åº”æ¶ˆæ¯ |
| data.user | object | ç”¨æˆ·ä¿¡æ¯å¯¹è±¡ |
| data.user.id | string | ç”¨æˆ· IDï¼ˆUUID æ ¼å¼ï¼‰ |
| data.user.username | string | ç”¨æˆ·å |
| data.user.email | string | é‚®ç®±åœ°å€ |
| data.user.role | string | ç”¨æˆ·è§’è‰²ï¼ˆ`admin` æˆ– `operator`ï¼‰ |
| data.user.is_active | boolean | æ˜¯å¦æ¿€æ´» |
| data.user.created_at | string | åˆ›å»ºæ—¶é—´ï¼ˆISO 8601ï¼‰ |
| data.user.updated_at | string | æ›´æ–°æ—¶é—´ï¼ˆISO 8601ï¼‰ |
| data.token | string | JWT Tokenï¼ˆæœ‰æ•ˆæœŸ7å¤©ï¼‰ |

---

### é”™è¯¯å“åº”

**400 Bad Request** - å‚æ•°ç¼ºå¤±
```json
{
  "message": "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º"
}
```

**401 Unauthorized** - ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
```json
{
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
}
```

**500 Internal Server Error** - æœåŠ¡å™¨é”™è¯¯
```json
{
  "message": "ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"
}
```

---

### ä»£ç ç¤ºä¾‹

#### cURL
```bash
curl -X POST "http://localhost:3000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

#### JavaScript (Axios)
```javascript
import axios from 'axios';

const login = async (username, password) => {
  try {
    const response = await axios.post('/api/v1/auth/login', {
      username,
      password
    });

    const { user, token } = response.data.data;

    // ä¿å­˜ Token åˆ° localStorage
    localStorage.setItem('token', token);
    localStorage.setItem('user', JSON.stringify(user));

    return response.data;
  } catch (error) {
    console.error('ç™»å½•å¤±è´¥:', error.response.data);
    throw error;
  }
};
```

#### Kotlin (Retrofit)
```kotlin
interface AuthApi {
    @POST("/api/v1/auth/login")
    suspend fun login(@Body request: LoginRequest): Response<LoginResponse>
}

data class LoginRequest(
    val username: String,
    val password: String
)
```

#### Swift (Alamofire)
```swift
struct LoginRequest: Codable {
    let username: String
    let password: String
}

AF.request("/api/v1/auth/login",
           method: .post,
           parameters: LoginRequest(username: "admin", password: "admin123"),
           encoder: JSONParameterEncoder.default)
    .responseDecodable(of: LoginResponse.self) { response in
        // å¤„ç†å“åº”
    }
```

---

### æ³¨æ„äº‹é¡¹

- âš ï¸ **å¯†ç å®‰å…¨**ï¼šå¯†ç å¿…é¡»é€šè¿‡ HTTPS ä¼ è¾“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- âš ï¸ **Token æœ‰æ•ˆæœŸ**ï¼šé»˜è®¤ 7 å¤©ï¼Œè¿‡æœŸåéœ€é‡æ–°ç™»å½•
- âš ï¸ **å¯†ç å¼ºåº¦**ï¼šå»ºè®®è‡³å°‘ 6 ä½å­—ç¬¦
- âœ… **å¼€å‘ç¯å¢ƒ**ï¼šæ”¯æŒ Mock Tokenï¼ˆ`mock-token-admin`ï¼‰

---

## 1.2 ç”¨æˆ·é€€å‡º

**åŸºæœ¬ä¿¡æ¯**
- **æ¥å£åç§°**: ç”¨æˆ·é€€å‡º
- **ç«¯ç‚¹**: `POST /api/v1/auth/logout`
- **åŠŸèƒ½æè¿°**: ç”¨æˆ·é€€å‡ºç™»å½•ï¼ˆå½“å‰ä»…è¿”å›æˆåŠŸæ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯éœ€è‡ªè¡Œæ¸…é™¤ Tokenï¼‰
- **è®¤è¯è¦æ±‚**: âŒ ä¸éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: å…¬å¼€æ¥å£

---

### è¯·æ±‚å‚æ•°

æ— 

---

### æˆåŠŸå“åº”

**HTTP çŠ¶æ€ç **: `200 OK`

```json
{
  "message": "é€€å‡ºç™»å½•æˆåŠŸ"
}
```

---

### ä»£ç ç¤ºä¾‹

#### cURL
```bash
curl -X POST "http://localhost:3000/api/v1/auth/logout"
```

#### JavaScript (Axios)
```javascript
const logout = async () => {
  await axios.post('/api/v1/auth/logout');

  // æ¸…é™¤æœ¬åœ°å­˜å‚¨
  localStorage.removeItem('token');
  localStorage.removeItem('user');

  // è·³è½¬åˆ°ç™»å½•é¡µ
  window.location.href = '/login';
};
```

---

### æ³¨æ„äº‹é¡¹

- âš ï¸ **Token æ’¤é”€**ï¼šå½“å‰æœåŠ¡ç«¯ä¸æ”¯æŒä¸»åŠ¨æ’¤é”€ Token
- âœ… **å®¢æˆ·ç«¯å¤„ç†**ï¼šé€€å‡ºæ—¶éœ€æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ Token

---

## 1.3 æ£€æŸ¥ç³»ç»ŸçŠ¶æ€

**åŸºæœ¬ä¿¡æ¯**
- **æ¥å£åç§°**: æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
- **ç«¯ç‚¹**: `GET /api/v1/auth/system-status`
- **åŠŸèƒ½æè¿°**: æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å·²æœ‰ç”¨æˆ·ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹è®¾ç½®
- **è®¤è¯è¦æ±‚**: âŒ ä¸éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: å…¬å¼€æ¥å£

---

### è¯·æ±‚å‚æ•°

æ— 

---

### æˆåŠŸå“åº”

**HTTP çŠ¶æ€ç **: `200 OK`

```json
{
  "message": "ç³»ç»ŸçŠ¶æ€æ£€æŸ¥æˆåŠŸ",
  "data": {
    "hasUsers": true,
    "userCount": 5,
    "needsInitialSetup": false
  }
}
```

---

## 1.4 ç³»ç»Ÿåˆå§‹åŒ–

**åŸºæœ¬ä¿¡æ¯**
- **æ¥å£åç§°**: ç³»ç»Ÿåˆå§‹åŒ–
- **ç«¯ç‚¹**: `POST /api/v1/auth/initial-setup`
- **åŠŸèƒ½æè¿°**: åˆ›å»ºç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼ˆä»…å¯æ‰§è¡Œä¸€æ¬¡ï¼‰
- **è®¤è¯è¦æ±‚**: âŒ ä¸éœ€è¦è®¤è¯
- **æƒé™çº§åˆ«**: å…¬å¼€æ¥å£

---

### è¯·æ±‚å‚æ•°

**Body å‚æ•°** (application/json)

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|--------|------|--------|
| username | string | âœ… | - | ç®¡ç†å‘˜ç”¨æˆ·å | `"admin"` |
| password | string | âœ… | - | ç®¡ç†å‘˜å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ | `"admin123"` |

---

### æˆåŠŸå“åº”

**HTTP çŠ¶æ€ç **: `201 Created`

```json
{
  "message": "ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "username": "admin",
      "role": "admin",
      "is_active": true
    },
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

---

### é”™è¯¯å“åº”

**400 Bad Request** - ç³»ç»Ÿå·²åˆå§‹åŒ–
```json
{
  "message": "ç³»ç»Ÿå·²åˆå§‹åŒ–ï¼Œæ— æ³•é‡å¤è®¾ç½®"
}
```

---

## ç›¸å…³æ–‡æ¡£

- [è®¤è¯æœºåˆ¶è¯¦è§£](../02_è®¤è¯æœºåˆ¶è¯¦è§£.md)
- [é”™è¯¯å¤„ç†ä¸çŠ¶æ€ç ](../03_é”™è¯¯å¤„ç†ä¸çŠ¶æ€ç .md)
- [ç”¨æˆ·ç®¡ç†æ¨¡å—](./08_ç”¨æˆ·ç®¡ç†.md)

---

**æœ€åæ›´æ–°**: 2025-12-28
