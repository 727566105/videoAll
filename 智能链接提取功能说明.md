# 智能链接提取功能使用说明

## 功能概述

内容解析页面现已支持**智能链接提取**功能，可以直接粘贴包含中文、表情符号和特殊字符的混合文本，系统会自动识别并提取其中的小红书链接。

## 支持的输入方式

### 方式 1：直接粘贴链接（传统方式）

```
http://xhslink.com/o/20ANEUXQBVx
```

或

```
https://www.xiaohongshu.com/explore/123456789
```

### 方式 2：粘贴包含链接的混合文本（新增功能）✨

```
袜子挂好了吗 我要来啰🎅🏻 圣诞快乐快乐！ http://xhslink.com/o/20ANEUXQBVx
复制后打开【小红书】查看笔记！
```

系统会自动：
- ✅ 识别中文字符
- ✅ 识别表情符号（🎅🏻）
- ✅ 识别中文标点符号（【】）
- ✅ 提取有效链接
- ✅ 清理链接末尾的杂质

## 支持的链接格式

| 平台 | 链接格式 | 示例 |
|------|---------|------|
| **小红书** | xhslink.com 短链接 | `http://xhslink.com/o/20ANEUXQBVx` |
| **小红书** | 完整链接 | `https://www.xiaohongshu.com/explore/xxx` |
| **小红书** | 移动端链接 | `https://xhslink.com/xxx` |
| **抖音** | 完整链接 | `https://www.douyin.com/video/xxx` |
| **抖音** | 短链接 | `https://v.douyin.com/xxx` |

## 特殊字符处理

系统能够正确处理以下特殊字符：

| 类型 | 示例 | 处理方式 |
|------|------|---------|
| **表情符号** | 🎅🏻 😊 ❤️ | 自动忽略 |
| **中文标点** | 【】。，！？；： | 自动忽略 |
| **英文标点** | ( ) [ ] { } | 自动忽略 |
| **引号** | "" '' ` ~ | 自动忽略 |
| **混合文本** | 中文 + Emoji + 链接 | 自动提取链接 |

## 使用场景

### 场景 1：从小红书 App 复制分享文本

**复制内容：**
```
袜子挂好了吗 我要来啰🎅🏻 圣诞快乐快乐！ http://xhslink.com/o/20ANEUXQBVx
复制后打开【小红书】查看笔记！
```

**操作步骤：**
1. 在输入框中粘贴上述文本
2. 点击"解析"按钮
3. 系统显示："✅ 使用小红书链接: http://xhslink.com/o/20ANEUXQBVx"
4. 自动开始解析

### 场景 2：包含多个链接的文本

**输入内容：**
```
查看我的视频 https://douyin.com/abc123
还有这个笔记 http://xhslink.com/xxx
```

**系统行为：**
- 自动检测到 2 个链接
- **优先使用小红书链接**
- 提示："已从文本中提取小红书链接，忽略其他 1 个链接"

### 场景 3：纯中文（无链接）

**输入内容：**
```
这是一段纯文本，没有包含任何链接
```

**系统行为：**
- ❌ 验证失败
- 提示："输入内容中未找到有效链接，请检查后重试"

## 技术实现

### 链接提取正则表达式

```javascript
// 支持多种链接格式的正则表达式
const patterns = [
  // 标准HTTP/HTTPS链接（支持中文参数和路径）
  /https?:\/\/[^\s\u4e00-\u9fa5\)\]}》】，。！？；：""''`~]+[^\s\)\]}》】，。！？；：""''`~]*/gi,
  // 小红书短链接 xhslink.com
  /https?:\/\/xhslink\.com\/[a-zA-Z0-9]+/gi,
  // 小红书完整链接
  /https?:\/\/[a-z]*\.?xiaohongshu\.com\/[^\s\u4e00-\u9fa5]*/gi,
  // 抖音链接
  /https?:\/\/[a-z]*\.?douyin\.com\/[^\s\u4e00-\u9fa5]*/gi,
];
```

### 链接优先级

1. **小红书链接**（xhslink.com / xiaohongshu.com）- 最高优先级
2. **抖音链接**（douyin.com）
3. **其他 HTTP/HTTPS 链接**

### 输入验证

```javascript
validator: (_, value) => {
  if (!value || !value.trim()) {
    return Promise.reject('请输入作品链接或包含链接的文本');
  }

  // 检查是否包含链接
  const hasLink = /https?:\/\/[^\s]+/.test(value);

  if (!hasLink) {
    return Promise.reject('输入内容中未找到有效链接，请检查后重试');
  }

  return Promise.resolve();
}
```

## 用户界面改进

### 输入框增强

- ✅ 改为多行文本输入框（TextArea）
- ✅ 支持自动高度调整（2-6 行）
- ✅ 更详细的占位符提示
- ✅ 添加提示文本和快捷按钮

### 提示信息

系统会在以下情况显示提示：

| 情况 | 提示信息 |
|------|---------|
| 检测到中文并成功提取链接 | "已从文本中提取链接: http://..." |
| 提取到小红书链接（多个链接） | "已从文本中提取小红书链接，忽略其他 N 个链接" |
| 检测到中文但未找到链接 | "未在文本中找到有效的链接，请检查输入内容" |

## 控制台日志

开发模式下，系统会在浏览器控制台输出详细的处理过程：

```
📝 原始输入内容: 袜子挂好了吗 我要来啰🎅🏻 圣诞快乐快乐！ http://xhslink.com/o/20ANEUXQBVx
🔤 包含中文: true
🔗 提取到的链接: ["http://xhslink.com/o/20ANEUXQBVx"]
✅ 使用小红书链接: http://xhslink.com/o/20ANEUXQBVx
🎯 最终使用的链接: http://xhslink.com/o/20ANEUXQBVx
```

## 测试用例

### 测试用例 1：基本混合文本

**输入：**
```
测试标题 http://xhslink.com/o/20ANEUXQBVx 查看更多
```

**预期结果：**
- ✅ 成功提取链接
- ✅ 正常解析内容

### 测试用例 2：包含表情符号

**输入：**
```
🎅🏻 圣诞快乐！ http://xhslink.com/o/20ANEUXQBVx ❤️
```

**预期结果：**
- ✅ 成功提取链接
- ✅ 忽略表情符号
- ✅ 正常解析内容

### 测试用例 3：包含中文标点

**输入：**
```
这是一个笔记【链接】http://xhslink.com/o/20ANEUXQBVx，快来看！
```

**预期结果：**
- ✅ 成功提取链接
- ✅ 清理末尾标点
- ✅ 正常解析内容

### 测试用例 4：多链接混合文本

**输入：**
```
抖音视频：https://douyin.com/abc123
小红书笔记：http://xhslink.com/xxx
```

**预期结果：**
- ✅ 提取到 2 个链接
- ✅ 优先使用小红书链接
- ✅ 显示忽略提示

## 注意事项

1. **链接有效性**：系统只负责提取链接，不验证链接是否有效
2. **编码问题**：支持 UTF-8 编码的所有字符
3. **链接长度**：没有长度限制
4. **浏览器兼容**：需要现代浏览器（Chrome 80+, Firefox 75+, Safari 13+）

## 更新日志

**2025-12-25**
- ✅ 新增智能链接提取功能
- ✅ 支持混合文本输入
- ✅ 支持表情符号和特殊字符
- ✅ 改进输入框为多行文本
- ✅ 添加详细的用户提示
- ✅ 优化链接提取算法

---

**相关文件：**
- [ContentParsing.jsx](frontend/src/pages/ContentParsing.jsx) - 内容解析页面组件
